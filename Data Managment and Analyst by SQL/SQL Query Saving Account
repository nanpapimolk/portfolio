Datasourece is confidential

The following SQL statements are used to demonstrate banking transactions and loan summaries for individual customers, using the given tables: 
Customer (personal_id, personal_name, type, gender), Account (account_id, personal_id, open_date, close_date), 
Deposit (account_id, date, activity (deposit/withdraw), amount), and Loan (personal_id, start_date, end_date, amount).



First Query: Summarize individual banking transactions

This query summarizes individual banking transactions, including personal ID, deposit amount, withdrawal amount, current balance, 
number of deposits, and number of withdrawals.


SELECT
      -- personal id
      c.person_id, 
      -- Pull personal id
      SUM(CASE WHEN d.type = 'deposit' THEN d.amount ELSE 0 END), 
      SUM(CASE WHEN d.type = 'withdraw' THEN d.amount ELSE 0 END), 
      SUM(CASE WHEN d.type = 'deposit' THEN d.amount ELSE 0 END) + SUM(CASE WHEN d.type = 'withdraw' THEN d.amount ELSE 0 END) AS current_amount,
      count(CASE WHEN d.type = 'deposit' THEN 1  END),
      count(CASE WHEN d.type = 'withdraw' THEN 1  END)
FROM Customer c
 LEFT JOIN Account a ON c.person_id = a.person_id
 LEFT JOIN Deposit d ON a.account_id = d.account_id
Group BY c.person_id


//
Second Query: Summarize current individual loans

This query summarizes the current individual loans, including the date as of, personal ID, customer type (cust_type), gender, 
the number of active accounts for each customer, and the number of active loan accounts.

SELECT
    c.person_id,
    c.gender,
    COUNT(DISTINCT a.account_id) AS active_accounts,
    COUNT(DISTINCT l.person_id) AS active_loans,
    '2024-01-01' AS data_as_of
FROM
    Customer2 c
LEFT JOIN
    Account2 a ON c.person_id = a.person_id AND a.close_date > '2024-01-01'
LEFT JOIN
    Loan l ON c.person_id = l.person_id AND l.end_date > '2024-01-01'
GROUP BY
    c.person_id, c.gender;
